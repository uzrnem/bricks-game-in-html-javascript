<html>
    <style>
:root {
  --main-bg-color: #bfc8b2;
  --deem-color: #9da591;
  --dark-color: #000000;
  --pixel-size: 0.6em;
  --pixel-border-size: 0.2em;
}
div {
    float: left;
}
span {
    border: var(--pixel-border-size) solid var(--main-bg-color);
    outline: var(--pixel-border-size) solid var(--deem-color);
    background-color: var(--deem-color);
    content: " ";
    display: block;
    width: var(--pixel-size);
    height: var(--pixel-size);
    margin: 0.15em;
}
.active {
    outline-color: var(--dark-color);
    background-color: var(--dark-color);
}
table {
    background-color: var(--main-bg-color);
    border: .1em solid;
}
</style>
    <body>
        <div id="tablecontainer">
        </div>
        <div>
            <table style="padding: 1em;">
                <tr>
                    <td><h1>Tetris Game</h1></td>
                </tr>
                <tr>
                    <td>Score: <text id="score"><b>0</b></text></td>
                </tr>
                <tr>
                    <td>Level: <text id="level"><b>0</b></text></td>
                </tr>
                <tr>
                    <td>Message: <b><text id="message"></text></b></td>
                </tr>
                <tr>
                    <td>Restart: <button onclick="init()">Restart</button> </td>
                </tr>
                <tr id="pause">
                    <td>Pause: <button onclick="pause()">Pause</button> <b>[space]</b> </td>
                </tr>
                <tr id="resume" style="display: none;">
                    <td>Resume: <button onclick="resume()">Resume</button> <b>[space]</b> </td>
                </tr>
            </table>
        </div>
    </body>
<script>
const containerDiv = document.getElementById("tablecontainer");
const table = document.createElement("table");
for (var yc = 0; yc < 20; yc++) {
    const tr = document.createElement("tr");
    for (var xc = 0; xc < 10; xc++) {
        const td = document.createElement("td");
        const span = document.createElement("span");
        span.id = `pixel_${xc}_${yc}`
        td.appendChild(span);
        tr.appendChild(td);
    }
    table.appendChild(tr);
}
containerDiv.appendChild(table);
    

var speed = null;
var score = 0;
var level = 1;
var timer = null;
var status = null;
var object = null;
var screen = null;

function getObject() {
    var count = Math.floor(Math.random() * 21);
    switch (count % 7) {
    case 0: return {x:3, y:0, cordinates:[{x:4, y:0}, {x:4, y:1}, {x:4, y:2}, {x:4, y:3}]}; //  |
    case 1: return {x:3, y:-1, cordinates:[{x:4, y:1}, {x:5, y:1}, {x:4, y:0}, {x:5, y:0}]}; // ::
    case 2: return {x:4, y:-1, cordinates:[{x:5, y:2}, {x:5, y:1}, {x:5, y:0}, {x:6, y:1}]}; // .:.
    case 3: return {x:3, y:-1, cordinates:[{x:3, y:1}, {x:3, y:0}, {x:4, y:0}, {x:5, y:0}]}; // ..:
    case 4: return {x:4, y:-1, cordinates:[{x:4, y:0}, {x:5, y:0}, {x:6, y:1}, {x:6, y:0}]}; // :..
    case 5: return {x:3, y:-1, cordinates:[{x:3, y:0}, {x:4, y:1}, {x:4, y:0}, {x:5, y:1}]}; // ':.
    case 6: return {x:4, y:-1, cordinates:[{x:4, y:1}, {x:5, y:1}, {x:5, y:2}, {x:4, y:0}]}; // .:'
    }
    /*
    switch (count % 7) { // return object type and angle store more information
    case 0: return [{x:4, y:0}, {x:4, y:1}, {x:4, y:2}, {x:4, y:3}]; //  |
    //case 0: return [{x:3, y:1}, {x:4, y:1}, {x:5, y:1}, {x:6, y:1}]; //  |

    case 1: return [{x:4, y:1}, {x:5, y:1}, {x:4, y:0}, {x:5, y:0}]; // ::

    case 2: return [{x:4, y:1}, {x:5, y:1}, {x:5, y:0}, {x:6, y:1}]; // .:.
    //case 2: return [{x:5, y:2}, {x:5, y:1}, {x:5, y:0}, {x:6, y:1}]; // .:.
    //case 2: return [{x:4, y:1}, {x:5, y:1}, {x:5, y:2}, {x:6, y:1}]; // .:.
    //case 2: return [{x:4, y:1}, {x:5, y:1}, {x:5, y:0}, {x:5, y:2}]; // .:.

    case 3: return [{x:3, y:1}, {x:3, y:0}, {x:4, y:0}, {x:5, y:0}]; // ..:
    //case 3: return [{x:4, y:1}, {x:3, y:0}, {x:4, y:0}, {x:4, y:2}]; // ..:

    case 4: return [{x:4, y:0}, {x:5, y:0}, {x:6, y:1}, {x:6, y:0}]; // :..
    //case 4: return [{x:5, y:2}, {x:5, y:0}, {x:5, y:1}, {x:6, y:0}]; // :..

    case 5: return [{x:3, y:0}, {x:4, y:1}, {x:4, y:0}, {x:5, y:1}]; // ':.
    //case 5: return [{x:5, y:0}, {x:4, y:1}, {x:4, y:2}, {x:5, y:1}]; // ':.

    //case 6: return [{x:4, y:1}, {x:5, y:1}, {x:5, y:0}, {x:6, y:0}]; // .:'
    case 6: return [{x:4, y:1}, {x:5, y:1}, {x:5, y:2}, {x:4, y:0}]; // .:'
    }
    */
}

function addObjectToScreen(object, screen) {
    for (var c = 0; c < object.cordinates.length; c++) {
        var obj = object.cordinates[c];
        screen[`y_${obj.y}`][`x_${obj.x}`] = 1;
    }
}

function displayObjectWithScreen(object, screen) {
    var isListCreated = false
    for (var yc = 0; yc < 20; yc++) {
        var lineCount = 0;
        for (var xc = 0; xc < 10; xc++) {
            if (screen[`y_${yc}`][`x_${xc}`] == 1) {
                lineCount = lineCount + 1;
                document.getElementById(`pixel_${xc}_${yc}`).className = "active";
            } else {
                document.getElementById(`pixel_${xc}_${yc}`).className = "";
            }
        }
        if (lineCount == 10) {
            isListCreated = true;
        }
    }

    if (object != null) {
        for (var c = 0; c < object.cordinates.length; c++) {
            var obj = object.cordinates[c];
            document.getElementById(`pixel_${obj.x}_${obj.y}`).className = "active";
        }
    }
    return isListCreated;
}

function removeCompletedLines() {
    arr = [];
    for (var yc = 20 - 1; yc >= 0; yc--) {
        var lineCount = 0;
        for (var xc = 0; xc < 10; xc++) {
            if (screen[`y_${yc}`][`x_${xc}`] == 1) {
                lineCount = lineCount + 1;
            }
        }
        if (lineCount == 10) {
            score++;
            document.getElementById("score").innerText = score;
        } else {
            arr.push(screen[`y_${yc}`]);
        }
    }
    for (var yc = 20 - 1; yc >= 0; yc--) {
        if (arr.length > 0) {
            screen[`y_${yc}`] = arr.shift();
        } else {
            screen[`y_${yc}`] = {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0};
        }
    }
    displayObjectWithScreen(object, screen);
}

function move() {
    if (object == null) {
        object = getObject();
        for (var c = 0; c < object.cordinates.length; c++) {
            var obj = object.cordinates[c];
            if (screen[`y_${object.cordinates[c].y + 1}`][`x_${object.cordinates[c].x}`] == 1 ||
                screen[`y_${object.cordinates[c].y}`][`x_${object.cordinates[c].x}`] == 1
            ) {
                displayObjectWithScreen(object, screen)
                document.getElementById("message").innerText = "Game Over..!";
                status = "stop";
                clearInterval(timer);
                object = null;
                timer = null;
                return;
            }
        }
    } else {
        moveDown();
    }
    var isListCreated = displayObjectWithScreen(object, screen);
    if (isListCreated) {
        setTimeout(removeCompletedLines, speed / 3);
    }
}

function moveDown() {
    if (object == null) {
        return;
    }
    for (var c = 0; c < object.cordinates.length; c++) {
        var obj = object.cordinates[c];
        if (obj.y == 19 || screen[`y_${object.cordinates[c].y + 1}`][`x_${object.cordinates[c].x}`] == 1) {
            addObjectToScreen(object, screen);
            object = null;
            return;
        }
    }
    object.y = object.y + 1;
    for (var c = 0; c < object.cordinates.length; c++) {
        var obj = object.cordinates[c];
        object.cordinates[c].y = object.cordinates[c].y + 1;
    }
    displayObjectWithScreen(object, screen);
}


function moveLeft() {
    if (object == null) {
        return;
    }
    for (var c = 0; c < object.cordinates.length; c++) {
        if (object.cordinates[c].x == 0 || screen[`y_${object.cordinates[c].y}`][`x_${object.cordinates[c].x -1 }`] == 1) {
            return;
        }
    }
    object.x = object.x - 1;
    for (var c = 0; c < object.cordinates.length; c++) {
        var obj = object.cordinates[c];
        object.cordinates[c].x = object.cordinates[c].x - 1;
    }
    displayObjectWithScreen(object, screen);
}

function moveRight() {
    if (object == null) {
        return;
    }

    for (var c = 0; c < object.cordinates.length; c++) {
        if (object.cordinates[c].x == 9 || screen[`y_${object.cordinates[c].y}`][`x_${object.cordinates[c].x + 1 }`] == 1) {
            return;
        }
    }
    object.x = object.x + 1;
    for (var c = 0; c < object.cordinates.length; c++) {
        var obj = object.cordinates[c];
        object.cordinates[c].x = object.cordinates[c].x + 1;
    }
    displayObjectWithScreen(object, screen);
}

function changeObject() {
    if (object == null) {
        return;
    }
    var newList = [];
    for (var xc = 0; xc < object.cordinates.length; xc++) {
        var obj = object.cordinates[xc];

        var [x, y] = rotateCordinates(obj.x - object.x, obj.y - object.y)
        var item = {x: x + object.x, y: y + object.y}
        if (item.x < 0 || item.x > 9 || screen[`y_${object.cordinates[xc].y}`][`x_${object.cordinates[xc].x }`] == 1 ||
            item.y < 0 || item.y > 19) {
            return;
        }
        newList.push(item);
    }
    object = {x: object.x, y: object.y, cordinates: newList}
    displayObjectWithScreen(object, screen);
}

function rotateCordinates(x, y) {
    var matrix = [
        [[3, 0], [3, 1], [3, 2], [3, 3]],
        [[2, 0], [2, 1], [2, 2], [2, 3]],
        [[1, 0], [1, 1], [1, 2], [1, 3]],
        [[0, 0], [0, 1], [0, 2], [0, 3]]
    ]
    return matrix[y][x]
}

function init() {
    speed = 400;
    level = 0;
    score = 0;
    status = "start";
    object = null;
    screen = {
        y_0: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_1: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_2: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_3: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_4: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_5: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_6: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_7: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_8: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_9: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_10: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_11: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_12: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_13: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_14: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_15: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_16: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_17: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_18: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
        y_19: {x_0: 0, x_1: 0, x_2: 0, x_3: 0, x_4: 0, x_5: 0, x_6: 0, x_7: 0, x_8: 0, x_9: 0},
    };
    document.getElementById("level").innerText = level;
    document.getElementById("score").innerText = score;
    document.getElementById("message").innerText = "Game Started..!";
    if (timer == null) {
        timer = setInterval(move, speed);
    }
}

function pause() {
    if (status == "start") {
        status = "pause";
        clearInterval(timer);
        timer = null;
        document.getElementById("message").innerText = "Game Paused..!";
        document.getElementById("pause").style = "display: none;";
        document.getElementById("resume").style = "";
    }
}

function resume() {
    if (status == "pause") {
        status = "start";
        timer = setInterval(move, speed);
        document.getElementById("message").innerText = "Game Resumed..!";
        document.getElementById("pause").style = "";
        document.getElementById("resume").style = "display: none;";
    }
}

document.addEventListener('keyup', (e) => {
    if (e.code == 'Space') {
        if (status == "start") {
            pause();
        } else if (status == "pause") {
            resume();
        }
    }
    if ((e.code == 'ArrowUp' || e.code == 'KeyW')) {
        changeObject();
    } else if ((e.code == 'ArrowLeft' || e.code == 'KeyA')) {
        moveLeft();
    } else if ((e.code == 'ArrowRight' || e.code == 'KeyD')) {
        moveRight();
    } else if ((e.code == 'ArrowDown' || e.code == 'KeyS')) {
        moveDown();
    }
});

init();
move();

</script>
</html>
